// generate-i18n-types.js

import fs from 'fs';
import path from 'path';

const inputFile = path.resolve(process.cwd(), 'locales/en.json');
const outputFile = path.resolve(process.cwd(), 'src/types/i18n.d.ts');

console.log('Generating TypeScript types for i18n...');

try {
  // Read and parse the source JSON file
  const jsonContent = fs.readFileSync(inputFile, 'utf-8');
  const messages = JSON.parse(jsonContent);

  // Function to recursively build the type string
  function generateType(obj, indent = '  ') {
    let typeString = '{\n';
    for (const key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        const value = obj[key];
        // Escape single quotes in keys if they exist
        const safeKey = key.includes("'") ? `"${key}"` : key;

        if (typeof value === 'object' && value !== null) {
          typeString += `${indent}${safeKey}: ${generateType(value, indent + '  ')};\n`;
        } else {
          typeString += `${indent}${safeKey}: string;\n`;
        }
      }
    }
    typeString += indent.slice(0, -2) + '}';
    return typeString;
  }

  const generatedType = generateType(messages);
  const fileContent = `// This file is auto-generated by generate-i18n-types.js\n// Do not edit this file directly\n\nexport interface MessageSchema ${generatedType}\n`;

  // Write the generated type definition to the output file
  fs.writeFileSync(outputFile, fileContent, 'utf-8');
  console.log(`Successfully generated i18n types at ${outputFile}`);
} catch (error) {
  console.error('Error generating i18n types:', error);
  process.exit(1);
}
