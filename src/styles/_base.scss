// =============================================================================
// Custom Scrollbar
// =============================================================================

@use 'mixins' as *;

// Standard CSS Scrollbars (Firefox)
// Firefox has limited support. It does not support pixel-perfect width,
// border-radius, borders, or shadows on scrollbars.
* {
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb-color) var(--scrollbar-track-color);
}

// Webkit Scrollbars (Chrome, Safari, Edge, Opera)
::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width); // Support horizontal scrollbar sizing too
  scrollbar-gutter: stable;
}

::-webkit-scrollbar-track {
  cursor: default;
  background-color: transparent; // Defaults transparent unless hovered usually
  border-radius: var(--scrollbar-track-radius);

  &:hover {
    background-color: var(--scrollbar-track-color);
  }
}

::-webkit-scrollbar-thumb {
  min-height: 40px;
  background-color: var(--scrollbar-thumb-color);

  // Granular control
  border-radius: var(--scrollbar-thumb-radius);
  border: var(--scrollbar-thumb-border-width) solid transparent;
  box-shadow: inset 0 0 0 1px var(--scrollbar-thumb-shadow-color);

  background-clip: content-box;
  cursor: grab;

  &:active {
    cursor: grabbing;
  }
}

// =============================================================================
// Global Styles & Resets
// =============================================================================

* {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-tap-highlight-color: transparent;
  text-shadow: 0 0 var(--shadow-blur-radius) var(--theme-shadow-color);
}

html {
  // Performance tweak for Chrome to prevent flickering on blurred elements.
  -webkit-transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
}

body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  height: 100dvh; // Use dynamic viewport height where supported
  overflow: hidden; // App manages its own scrolling regions

  background-color: var(--theme-background-tint);
  // background-image property would be set here if there is one
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;

  font-family: var(--font-family-main);
  font-size: var(--font-size-main);
  color: var(--theme-text-color);

  // Enforce a light color-scheme to prevent browser-native dark mode UI
  // from overriding app styles (e.g., for form controls).
  color-scheme: light;
}

input,
select,
button {
  font-family: var(--font-family-main), sans-serif;
  font-size: var(--font-size-main);
  color: var(--theme-text-color);
}

textarea {
  width: 100%;
  resize: vertical;
  display: block;
  border: 1px solid var(--theme-border-color);
  border-radius: var(--base-border-radius);
  outline: none;
  background-color: var(--black-50a);
  color: var(--theme-text-color);
  font-family: var(--font-family-main);
  font-size: var(--font-size-main);
  padding: var(--textarea-padding-y) var(--textarea-padding-x);
}

input[type='range'] {
  -webkit-appearance: none;
  appearance: none;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 5px;
  background: var(--black-30a);
  border-radius: 15px;
  background-size: 70% 100%;
  background-repeat: no-repeat;
  box-shadow: inset 0 0 2px black;
  cursor: ew-resize;
  transition: all var(--animation-duration-2x) ease-in-out;
  filter: brightness(0.75);
}

select {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  padding: var(--spacing-xs);
  background-color: var(--black-30a);
  border: 1px solid var(--theme-border-color);
  border-radius: var(--base-border-radius);
  margin-bottom: var(--spacing-xs);
  background-image: url('/img/down-arrow.svg');
  background-repeat: no-repeat;
  background-position: right 4px center;
  background-size: 8px 4px;
}

select option {
  /* works to highlight selected/active option */
  background-color: var(--white-50a);
  color: var(--black-70a);
}

select option:not(:checked) {
  /* works to color unselected items */
  background-color: var(--black-70a);
  color: var(--white-70a);
}

select option[disabled]:not(:checked) {
  color: var(--white-30a);
}

.text-pole {
  background-color: var(--black-30a);
  color: var(--theme-text-color);
  border: 1px solid var(--theme-border-color);
  border-radius: var(--base-border-radius);
  font-family: var(--font-family-main);
  padding: var(--spacing-xs);
  width: 100%;
  margin: var(--spacing-xs) 0;
  @include input-base();
}

select.text-pole {
  padding-right: calc(var(--spacing-md) + var(--spacing-xs));
}

.menu-button {
  color: var(--theme-text-color);
  background-color: var(--theme-background-tint);
  border: 1px solid var(--theme-border-color);
  border-radius: var(--base-border-radius);
  padding: var(--spacing-xs);
  cursor: pointer;
  transition: background-color var(--animation-duration-2x);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  filter: grayscale(0.5);

  &:not(.disabled):not([disabled]):hover {
    background-color: var(--white-30a);
  }

  &.active {
    background-color: var(--theme-emphasis-color);
    color: var(--black-100);
    filter: none;
    border-color: var(--theme-quote-color);
  }

  &.disabled,
  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed !important;
    filter: grayscale(1);
    pointer-events: none;
  }

  &--danger {
    color: var(--color-warning);
    &:hover:not(.disabled):not([disabled]) {
      background-color: var(--color-accent-crimson-hover);
    }
  }

  &--confirm {
    &:hover:not(.disabled):not([disabled]) {
      filter: brightness(120%);
    }
  }

  &--ghost {
    background-color: transparent;
    border: 0;
    opacity: 0.7;

    &:hover:not(.disabled) {
      background-color: var(--white-20a);
      opacity: 1;
    }

    &.active {
      background-color: transparent;
      opacity: 1;
      color: unset;
    }
  }
}

// =============================================================================
// Animations
// =============================================================================

@keyframes flash {
  0%,
  50%,
  100% {
    opacity: 1;
  }

  25%,
  75% {
    opacity: 0.2;
  }
}

.animated {
  -webkit-animation-duration: var(--animation-duration, 3s);
  animation-duration: var(--animation-duration, 3s);
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
  box-shadow: inset 0 0 5px var(--theme-quote-color);
}

.flash {
  animation-name: flash;
}

// Keyframe animations used throughout the app
@keyframes flash {
  0%,
  50%,
  100% {
    opacity: 1;
  }

  25%,
  75% {
    opacity: 0.2;
  }
}

@keyframes typing-bounce {
  0%,
  80%,
  100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeInQuick {
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animations-disabled {
  animation: none !important;
  transition: none !important;
}

.animations-disabled .animated {
  animation: none !important;
}

.animations-disabled .flash {
  animation: none !important;
}

.animations-disabled {
  .typing-bounce {
    animation: none !important;
  }

  .slideUp {
    animation: none !important;
  }

  .fadeIn {
    animation: none !important;
  }

  .fadeInQuick {
    animation: none !important;
  }
}

// =============================================================================
// Main Layout
// =============================================================================

#main-content {
  position: absolute;
  top: 0;
  left: var(--nav-bar-width);
  right: 0;
  margin: 0 auto;
  width: var(--panel-width);
  height: 100vh;
  transition:
    left 0.3s ease,
    right 0.3s ease,
    width 0.3s ease;

  &.full-screen {
    width: auto;

    &.left-open {
      left: calc(var(--nav-bar-width) + var(--sidebar-left-width, var(--sidebar-width)));
    }

    &.right-open {
      right: var(--sidebar-right-width, var(--sidebar-width));
    }
  }

  // =============================================================================
  // Utility Classes
  // =============================================================================

  .font-bold {
    font-weight: bold;
  }

  // =============================================================================
  // Common Layout Components
  // =============================================================================

  .standalone-pane {
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background-color: var(--theme-background-tint);
    min-height: 0;
    min-width: 0;
  }

  .main-page-content {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
  }

  // =============================================================================
  // Layout Components
  // =============================================================================

  .content-wrapper {
    height: calc(100% - var(--header-height));
    position: relative;
  }
}

// =============================================================================
// Mobile Layout Overrides
// =============================================================================
@media (max-width: 768px) {
  #main-content {
    /* Reset absolute positioning for mobile flow */
    position: relative;
    left: 0 !important;
    width: 100% !important;
    margin: 0;

    /* Adjust height to account for bottom navbar */
    height: calc(100vh - var(--nav-bar-height, 60px));
    height: calc(100dvh - var(--nav-bar-height, 60px));

    /* Disable the pushing effect of sidebars on mobile */
    &.full-screen.left-open,
    &.full-screen.right-open {
      left: 0 !important;
      right: 0 !important;
      transform: none;
    }
  }
}
