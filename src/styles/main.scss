// =============================================================================
// Core Variables
//
// These are SCSS variables that define the base palette and core metrics.
// They are used to generate the CSS custom properties for theming.
// =============================================================================

// Base color palette
$black: #000;
$white: #fff;

$grey-10: rgb(25, 25, 25);
$grey-30: rgb(75, 75, 75);
$grey-50: rgb(125, 125, 125);
$grey-70: rgb(175, 175, 175);
$grey-75: rgb(190, 190, 190);

$red: #f00;
$green: #006400; // dark green
$blue: #6464ff; // cobalt-ish
$ivory: rgb(220, 220, 210);
$golden: rgb(248, 211, 0);

// Base metrics
$base-font-scale: 1;
$base-font-size: 15px;
$base-animation-duration: 125ms;
$base-border-radius: 2px;
$base-border-radius-round: 50%;
$base-border-radius-rounded: 10px;

// =============================================================================
// CSS Custom Properties (:root)
//
// These variables control the application's theme and are exposed to be
// easily manipulated by JavaScript for user-customizable themes.
// =============================================================================

:root {
  // --- Color System ---
  --transparent: rgba(0, 0, 0, 0);

  // Black with alpha
  --black-30a: #{rgba($black, 0.3)};
  --black-50a: #{rgba($black, 0.5)};
  --black-60a: #{rgba($black, 0.6)};
  --black-70a: #{rgba($black, 0.7)};
  --black-90a: #{rgba($black, 0.9)};
  --black-100: #{$black};

  // White with alpha
  --white-20a: #{rgba($white, 0.2)};
  --white-30a: #{rgba($white, 0.3)};
  --white-50a: #{rgba($white, 0.5)};
  --white-60a: #{rgba($white, 0.6)};
  --white-70a: #{rgba($white, 0.7)};
  --white-100: #{$white};

  // Grey with alpha
  --grey-30a: #{rgba($grey-30, 0.3)};
  --grey-5020a: #{rgba($grey-50, 0.2)};
  --grey-5050a: #{rgba($grey-50, 0.5)};
  --grey-7070a: #{rgba($grey-70, 0.7)};
  --grey-cai-bg: rgb(36, 36, 37);

  // Accents & Status
  --color-accent-red: #{$red};
  --color-accent-crimson-70a: #{rgba(100, 0, 0, 0.7)};
  --color-accent-crimson-hover: #{rgba(150, 50, 50, 0.5)};
  --color-accent-green-70a: #{rgba($green, 0.7)};
  --color-accent-cobalt-30a: #{rgba($blue, 0.3)};
  --color-golden: #{$golden};
  --color-warning: #{rgba($red, 0.9)};
  --color-active: rgb(88, 182, 0);
  --color-preferred: rgb(244, 67, 54);

  // --- Default Theme ---
  // These are the core theme variables. They are intentionally verbose
  // to allow for fine-grained control.
  --theme-text-color: #{$ivory};
  --theme-emphasis-color: #{rgb(145, 145, 145)};
  --theme-underline-color: #{rgb(188, 231, 207)};
  --theme-quote-color: #{rgb(225, 138, 36)};
  --theme-background-tint: #{rgb(23, 23, 23)};
  --theme-chat-tint: #{rgb(23, 23, 23)};
  --theme-user-message-tint: #{rgba(0, 0, 0, 0.3)};
  --theme-bot-message-tint: #{rgba(60, 60, 60, 0.3)};
  --theme-shadow-color: #{rgba(0, 0, 0, 0.5)};
  --theme-border-color: #{rgba(0, 0, 0, 0.5)};

  // Checkbox colors for calculating tick color
  --theme-checkbox-bg-r: 220;
  --theme-checkbox-bg-g: 220;
  --theme-checkbox-bg-b: 210;

  // Calculates a contrasting tick color (black/white) based on luminance.
  --theme-checkbox-tick-color-value: calc((((((var(--theme-checkbox-bg-r) * 299) + (var(--theme-checkbox-bg-g) * 587) + (var(--theme-checkbox-bg-b) * 114)) / 1000) - 128) * -1000));
  --theme-checkbox-tick-color: rgb(var(--theme-checkbox-tick-color-value),
      var(--theme-checkbox-tick-color-value),
      var(--theme-checkbox-tick-color-value));

  // --- Layout & Sizing ---
  --layout-panel-width: 50vw;
  --layout-message-right-spacing: 30px;

  // Font
  --font-scale: #{$base-font-scale};
  --font-size-main: calc(var(--font-scale) * #{$base-font-size});
  --font-family-main: 'Noto Sans', sans-serif;
  --font-family-mono: 'Noto Sans Mono', 'Courier New', Consolas, monospace;

  // Send Form
  --send-form-padding: calc(var(--font-size-main) / 2.5);
  --send-form-icon-size: calc(var(--font-size-main) * 1.9);
  --send-form-height: calc(var(--send-form-icon-size) + var(--send-form-padding));

  // Top Bar
  --top-bar-padding: calc(var(--font-size-main) / 3);
  --top-bar-icon-size: calc(var(--font-size-main) * 2);
  --top-bar-height: calc(var(--top-bar-icon-size) + var(--top-bar-padding));

  // Avatars
  --avatar-height: 50px;
  --avatar-width: 50px;
  --avatar-border-radius: #{$base-border-radius};
  --avatar-border-radius-round: #{$base-border-radius-round};
  --avatar-border-radius-rounded: #{$base-border-radius-rounded};
  --avatar-inline-small-factor: 0.6;

  // --- Effects ---
  --blur-strength: 10; // Unitless value for slider controls
  --blur-radius: calc(var(--blur-strength) * 1px);
  --shadow-width: 2; // Unitless value for slider controls
  --shadow-blur-radius: calc(var(--shadow-width) * 1px);

  // --- Animations ---
  --animation-duration: #{$base-animation-duration};
  --animation-duration-2x: calc(var(--animation-duration) * 2);
  --animation-duration-3x: calc(var(--animation-duration) * 3);

  // --- Interactables ---
  --interactable-outline-color: var(--white-100);
  --interactable-outline-color-faint: var(--white-20a);
}

// =============================================================================
// Custom Scrollbar
// =============================================================================

::-webkit-scrollbar {
  width: 0.7rem;
  scrollbar-gutter: stable;
}

::-webkit-scrollbar-track {
  cursor: default;

  &:hover {
    background-color: rgba(126, 126, 126, 0.2);
  }
}

::-webkit-scrollbar-thumb {
  min-height: 40px;
  background-color: var(--grey-7070a);
  box-shadow: inset 0 0 0 1px var(--black-50a);
  border-radius: 10px;
  background-clip: content-box;
  border: 2px solid transparent;
  cursor: grab;

  &:active {
    cursor: grabbing;
  }
}

// =============================================================================
// Global Styles & Resets
// =============================================================================

* {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-tap-highlight-color: transparent;
  text-shadow: 0 0 var(--shadow-blur-radius) var(--theme-shadow-color);
}

html {
  // Performance tweak for Chrome to prevent flickering on blurred elements.
  -webkit-transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
}

body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  height: 100dvh; // Use dynamic viewport height where supported
  overflow: hidden; // App manages its own scrolling regions

  background-color: var(--theme-background-tint);
  // background-image property would be set here if there is one
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;

  font-family: var(--font-family-main);
  font-size: var(--font-size-main);
  color: var(--theme-text-color);

  // Enforce a light color-scheme to prevent browser-native dark mode UI
  // from overriding app styles (e.g., for form controls).
  color-scheme: light;
}

textarea {
  width: 100%;
  resize: vertical;
  display: block;
  border: 1px solid var(--theme-border-color);
  border-radius: 5px;
  outline: none;
  background-color: rgba($black, 0.3);
  color: var(--theme-text-color);
  font-family: var(--font-family-main);
  font-size: var(--font-size-main);
  padding: 5px 10px;
}

#top-bar {
  width: var(--layout-panel-width);
  margin: 0 auto;
  left: 0;
  right: 0;
  display: inline-block;
  height: var(--top-bar-height);
  position: absolute;
  box-shadow: 0 2px 20px 0 var(--black-70a);
  backdrop-filter: blur(var(--blur-strength)px);
  background-color: var(--theme-background-tint);
  -webkit-backdrop-filter: blur(var(--blur-strength)px);
  z-index: 3005;
}

#background {
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
  position: absolute;
  width: 100%;
  height: 100%;
  transition: background-image var(--animation-duration-3x) ease-in-out;
  z-index: -1;
}

#sheld {
  display: flex;
  flex-direction: column;
  height: calc(100vh - var(--top-bar-height));
  overflow-x: hidden;
  position: absolute;
  top: var(--top-bar-height);
  left: 0;
  right: 0;
  margin: 0 auto;
  min-width: 100px;
  min-height: 100px;
  width: var(--layout-panel-width);

  .chat {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    max-height: calc(100vh - var(--top-bar-height) - var(--send-form-height));
    background-color: var(--theme-chat-tint);
  }

  .form-sheld {
    white-space: nowrap;
    margin: 1px auto 0 auto;
    z-index: 30;
    width: 100%;

    .send-form {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      margin: 0 auto 0 auto;
      border: 1px solid var(--theme-border-color);
      border-radius: 0 0 10px 10px;
      width: 100%;
      background-color: var(--theme-background-tint);

      .form-items {
        width: 100%;
        display: flex;
        flex-direction: row;
        column-gap: 5px;
        font-size: var(--font-size-main);
        #send-textarea {
          min-height: calc(var(--send-form-height) + 2px);
          height: calc(var(--send-form-height) + 2px);
          word-wrap: break-word;
          resize: vertical;
          display: block;
          background-color: rgba(255, 0, 0, 0);
          border: none;
          box-shadow: none;
          flex: 1;
        }
      }
    }
  }
}